<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artevia Cafe - Menu Setup</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style> body { font-family: 'Inter', sans-serif; } </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

    <div class="w-full max-w-xl bg-white p-8 rounded-lg shadow-xl text-center">
        <h1 class="text-3xl font-bold text-yellow-900">One-Click Menu Setup</h1>
        <p class="text-gray-600 mt-2">This tool will add your entire menu to the Firebase database.</p>
        <p class="mt-4 p-3 bg-yellow-100 text-yellow-800 rounded-lg text-sm">
            <strong>Important:</strong> This is a one-time setup tool. After you run this successfully, you can delete this file. All future menu changes should be made using the `menu_manager.html` page.
        </p>
        
        <button id="populate-btn" class="w-full bg-green-700 text-white py-4 rounded-lg font-semibold text-lg hover:bg-green-800 transition transform hover:scale-105 mt-6">
            Add Full Menu to Database
        </button>

        <div id="log-container" class="mt-6 text-left text-sm bg-gray-800 text-white font-mono p-4 rounded-lg max-h-64 overflow-y-auto hidden">
            <p>Starting setup...</p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp, writeBatch, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyCuepnUYt_rDEffSraYycHxYrm5sDlXM6s",
            authDomain: "palette-orders.firebaseapp.com",
            projectId: "palette-orders",
            storageBucket: "palette-orders.appspot.com",
            messagingSenderId: "424044050877",
            appId: "1:424044050877:web:2c67d2d065d3411e173ad4",
            measurementId: "G-M5S8PYDFZ5"
        };
        const appId = 'palette-orders';
        
        let db;
        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            const auth = getAuth(app);
            await signInAnonymously(auth);
        } catch (error) {
            console.error("Firebase init failed:", error);
            document.body.innerHTML = `<div class="p-4 text-red-500 text-center"><strong>Firebase Connection Error.</strong></div>`;
        }

        const menuData = [
          // Soups
          { name: "Tomato Soup", price: 69, category: "Soups" },
          { name: "Sweet Corn Soup", price: 69, category: "Soups" },
          { name: "Mixed Veg Soup", price: 69, category: "Soups" },
          { name: "Mushroom Soup", price: 79, category: "Soups" },
          { name: "Chicken Soup", price: 89, category: "Soups" },
          { name: "Clear Chicken Soup", price: 89, category: "Soups" },
          { name: "Chicken Sweet Corn Soup", price: 99, category: "Soups" },
          // Appetizers
          { name: "Gobi Manchurian", price: 69, category: "Appetizers" },
          { name: "Mushroom Manchurian", price: 79, category: "Appetizers" },
          { name: "Mushroom 65", price: 89, category: "Appetizers" },
          { name: "Paneer Manchurian", price: 89, category: "Appetizers" },
          { name: "Paneer 65", price: 99, category: "Appetizers" },
          { name: "Aloo Chilli", price: 99, category: "Appetizers" },
          { name: "Mushroom Chilli", price: 99, category: "Appetizers" },
          { name: "Paneer Chilli", price: 109, category: "Appetizers" },
          { name: "Chicken Manchurian", price: 89, category: "Appetizers" },
          { name: "Chicken 65", price: 99, category: "Appetizers" },
          { name: "Chicken Kabab (3 pcs)", price: 99, category: "Appetizers" },
          { name: "Chicken Lollipop (3 pcs)", price: 100, category: "Appetizers" },
          { name: "Chicken Chilli", price: 109, category: "Appetizers" },
          { name: "Chicken Tikka", price: 149, category: "Appetizers" },
          // Momos
          { name: "Veg Momo (Steamed)", price: 59, category: "Momos" },
          { name: "Veg Momo (Fried)", price: 69, category: "Momos" },
          { name: "Veg Momo (Chilli)", price: 79, category: "Momos" },
          { name: "Chicken Momo (Steamed)", price: 89, category: "Momos" },
          { name: "Chicken Momo (Fried)", price: 99, category: "Momos" },
          { name: "Chicken Momo (Chilli)", price: 109, category: "Momos" },
          // Main Course
          { name: "Chicken Curry", price: 89, category: "Main Course" },
          { name: "Chicken Masala", price: 119, category: "Main Course" },
          { name: "Garlic Chicken", price: 129, category: "Main Course" },
          { name: "Afghani Chicken", price: 149, category: "Main Course" },
          { name: "Butter Chicken", price: 149, category: "Main Course" },
          { name: "Chicken Lababdar", price: 149, category: "Main Course" },
          { name: "Chicken Korma", price: 149, category: "Main Course" },
          { name: "Kadai Paneer", price: 119, category: "Main Course" },
          { name: "Matar Paneer", price: 119, category: "Main Course" },
          { name: "Butter Masala Paneer", price: 129, category: "Main Course" },
          { name: "Gobi Masala", price: 79, category: "Main Course" },
          { name: "Aloo Gobi", price: 79, category: "Main Course" },
          { name: "Bhindi Do Payaza", price: 79, category: "Main Course" },
          { name: "Aloo Jeera", price: 89, category: "Main Course" },
          { name: "Aloo Gobi Matar", price: 99, category: "Main Course" },
          { name: "Mushroom Masala", price: 99, category: "Main Course" },
          { name: "Kadai Mushroom", price: 109, category: "Main Course" },
          { name: "Mix Veg", price: 119, category: "Main Course" },
          // Dal
          { name: "Dal Tadka", price: 99, category: "Dal" },
          { name: "Dal Makhani", price: 109, category: "Dal" },
          // Egg Dishes
          { name: "Egg Poach", price: 29, category: "Egg Dishes" },
          { name: "Egg Omelette", price: 49, category: "Egg Dishes" },
          { name: "Egg Curry", price: 69, category: "Egg Dishes" },
          { name: "Egg Manchurian", price: 69, category: "Egg Dishes" },
          { name: "Egg Bhurji", price: 69, category: "Egg Dishes" },
          // Rice & Noodles
          { name: "Plain Rice", price: 59, category: "Rice & Noodles" },
          { name: "Jeera Rice", price: 69, category: "Rice & Noodles" },
          { name: "Gobi Fried Rice", price: 79, category: "Rice & Noodles" },
          { name: "Egg Fried Rice", price: 79, category: "Rice & Noodles" },
          { name: "Schezwan Gobi Fried Rice", price: 89, category: "Rice & Noodles" },
          { name: "Chicken Fried Rice", price: 89, category: "Rice & Noodles" },
          { name: "Paneer Fried Rice", price: 89, category: "Rice & Noodles" },
          { name: "Mushroom Fried Rice", price: 89, category: "Rice & Noodles" },
          { name: "Schezwan Chicken Fried Rice", price: 99, category: "Rice & Noodles" },
          { name: "Schezwan Paneer Fried Rice", price: 99, category: "Rice & Noodles" },
          { name: "Schezwan Mushroom Fried Rice", price: 99, category: "Rice & Noodles" },
          { name: "Chowmein (Veg)", price: 59, category: "Rice & Noodles" },
          { name: "Chowmein (Mushroom)", price: 69, category: "Rice & Noodles" },
          { name: "Thukpa (Veg)", price: 69, category: "Rice & Noodles" },
          { name: "Chowmein (Egg)", price: 79, category: "Rice & Noodles" },
          { name: "Chowmein (Chicken)", price: 89, category: "Rice & Noodles" },
          { name: "Thukpa (Chicken)", price: 99, category: "Rice & Noodles" },
          // Ramen
          { name: "Plain Ramen", price: 169, category: "Ramen" },
          { name: "Egg Ramen", price: 179, category: "Ramen" },
          { name: "Chicken Ramen", price: 199, category: "Ramen" },
          // Breads & Paratha
          { name: "Roti", price: 15, category: "Breads" },
          { name: "Naan", price: 39, category: "Breads" },
          { name: "Garlic Naan", price: 59, category: "Breads" },
          { name: "Garlic Butter Naan", price: 69, category: "Breads" },
          { name: "Plain Paratha", price: 39, category: "Breads" },
          { name: "Aloo Paratha", price: 49, category: "Breads" },
          { name: "Gobi Paratha", price: 49, category: "Breads" },
          { name: "Aloo Cheese Paratha", price: 69, category: "Breads" },
          { name: "Paneer Paratha", price: 69, category: "Breads" },
          { name: "Chicken Paratha", price: 69, category: "Breads" },
          // Thali
          { name: "Veg Thali", price: 99, category: "Thali" },
          { name: "Chole Rice", price: 99, category: "Thali" },
          { name: "Egg Thali", price: 109, category: "Thali" },
          { name: "Rajma Chawal", price: 110, category: "Thali" },
          { name: "Veg Premium Thali", price: 129, category: "Thali" },
          { name: "Chicken Thali", price: 139, category: "Thali" },
          { name: "Fish Thali", price: 139, category: "Thali" },
          // Rolls & Sides
          { name: "Veg Roll", price: 39, category: "Rolls & Sides" },
          { name: "Egg Roll", price: 59, category: "Rolls & Sides" },
          { name: "Chicken Roll", price: 69, category: "Rolls & Sides" },
          { name: "French Fries", price: 59, category: "Rolls & Sides" },
          { name: "Peri Peri Fries", price: 69, category: "Rolls & Sides" },
        ];

        const populateBtn = document.getElementById('populate-btn');
        const logContainer = document.getElementById('log-container');

        const log = (message, isError = false) => {
            const p = document.createElement('p');
            p.textContent = message;
            if(isError) p.className = 'text-red-400';
            else p.className = 'text-green-400';
            logContainer.appendChild(p);
            logContainer.scrollTop = logContainer.scrollHeight;
        };

        populateBtn.addEventListener('click', async () => {
            if (!db) {
                alert("Firebase is not connected.");
                return;
            }
            if (!confirm("Are you sure you want to add the entire menu? This will not clear existing items.")) {
                return;
            }

            populateBtn.disabled = true;
            populateBtn.textContent = 'Adding...';
            logContainer.classList.remove('hidden');

            const menuCollectionRef = collection(db, `artifacts/${appId}/public/data/menu`);
            const batch = writeBatch(db);

            menuData.forEach(item => {
                const docRef = doc(menuCollectionRef); // Create a new doc with a random ID
                const newItem = {
                    ...item,
                    discount: 0,
                    description: '',
                    imageUrl: null,
                    imageFileName: null,
                    createdAt: serverTimestamp(),
                    lastUpdated: serverTimestamp()
                };
                batch.set(docRef, newItem);
            });

            try {
                await batch.commit();
                log(`SUCCESS: ${menuData.length} menu items have been added to the database.`);
                populateBtn.textContent = 'Menu Added Successfully!';
                populateBtn.classList.remove('bg-green-700');
                populateBtn.classList.add('bg-blue-600');
            } catch (error) {
                console.error("Error adding documents: ", error);
                log(`ERROR: Could not add menu items. Check the console for details.`, true);
                populateBtn.disabled = false;
                populateBtn.textContent = 'Retry';
            }
        });
    </script>
</body>
</html>
