<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bulk Menu Adder - Artevia Palette</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .bg-brand { background-color: #a43c1a; }
        .hover\:bg-brand-dark:hover { background-color: #8a3216; }
        .text-brand { color: #a43c1a; }
        .border-brand { border-color: #a43c1a; }
        .ring-brand:focus { --tw-ring-color: #a43c1a; }
        th {
            position: sticky;
            top: 0;
            background-color: #f9fafb; /* gray-50 */
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 font-sans">

    <div class="container mx-auto p-4 md:p-8">
        <div class="bg-white rounded-lg shadow-xl overflow-hidden">
            <div class="text-center bg-brand p-4">
                <img src="https://raw.githubusercontent.com/Sarup098/artevia/main/Artevia_Palette_Logo.png" alt="Artevia Palette Logo" class="h-24 w-auto mx-auto mb-2">
                <h1 class="text-2xl font-bold text-white">Bulk Menu Adder</h1>
                <p class="text-gray-200">Add up to 15 items at once. Fill a row to add an item.</p>
            </div>
            
            <div class="max-h-[60vh] overflow-y-auto">
                <table class="w-full text-sm">
                    <thead class="text-left text-gray-700">
                        <tr>
                            <th class="px-2 py-3 w-1/12">#</th>
                            <th class="px-2 py-3 w-3/12">Item Name*</th>
                            <th class="px-2 py-3 w-1/12">Price*</th>
                            <th class="px-2 py-3 w-2/12">Category*</th>
                            <th class="px-2 py-3 w-5/12">Image Link*</th>
                        </tr>
                    </thead>
                    <tbody id="menu-form-body" class="divide-y">
                        <!-- 15 rows will be generated here by JS -->
                    </tbody>
                </table>
            </div>

            <div class="p-4 bg-gray-50 border-t">
                 <button id="save-all-btn" class="w-full bg-brand text-white font-bold py-3 px-4 rounded-md hover:bg-brand-dark transition duration-300">
                    Save All Items to Menu
                </button>
                 <p id="status-message" class="mt-4 text-center font-semibold"></p>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
        import { getFirestore, collection, writeBatch, doc } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCuepnUYt_rDEffSraYycHxYrm5sDlXM6s",
            authDomain: "palette-orders.firebaseapp.com",
            projectId: "palette-orders",
            storageBucket: "palette-orders.firebasestorage.app",
            messagingSenderId: "424044050877",
            appId: "1:424044050877:web:9ea875314de19b70173ad4",
            measurementId: "G-XNVCLD42Y4"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const formBody = document.getElementById('menu-form-body');
        const saveBtn = document.getElementById('save-all-btn');
        const statusMessage = document.getElementById('status-message');
        const NUM_ROWS = 15;

        // Generate the 15 empty rows on page load
        function generateRows() {
            let rowsHtml = '';
            for (let i = 1; i <= NUM_ROWS; i++) {
                rowsHtml += `
                    <tr class="menu-item-row">
                        <td class="px-2 py-1 text-center text-gray-500">${i}</td>
                        <td class="px-2 py-1"><input type="text" placeholder="Item Name" class="item-name w-full p-1 border rounded text-xs"></td>
                        <td class="px-2 py-1"><input type="number" placeholder="â‚¹" class="item-price w-full p-1 border rounded text-xs"></td>
                        <td class="px-2 py-1"><input type="text" placeholder="Category" class="item-category w-full p-1 border rounded text-xs"></td>
                        <td class="px-2 py-1"><input type="url" placeholder="Image URL" class="item-image-url w-full p-1 border rounded text-xs"></td>
                    </tr>
                `;
            }
            formBody.innerHTML = rowsHtml;
        }

        saveBtn.addEventListener('click', async () => {
            saveBtn.disabled = true;
            saveBtn.textContent = 'Saving...';
            statusMessage.textContent = '';

            const batch = writeBatch(db);
            const itemsToAdd = [];

            document.querySelectorAll('.menu-item-row').forEach(row => {
                const nameInput = row.querySelector('.item-name');
                const priceInput = row.querySelector('.item-price');
                const categoryInput = row.querySelector('.item-category');

                // Only process rows where at least a name and price are filled
                if (nameInput.value.trim() && priceInput.value) {
                    const newItem = {
                        name: nameInput.value.trim(),
                        price: parseFloat(priceInput.value),
                        category: categoryInput.value.trim() || 'Uncategorized',
                        imageUrl: row.querySelector('.item-image-url').value.trim(),
                        description: '', // Can be added to the table if needed
                        discount: 0,
                        stockStatus: 'in_stock'
                    };
                    itemsToAdd.push(newItem);
                }
            });

            if (itemsToAdd.length === 0) {
                statusMessage.textContent = 'No items to add. Please fill out at least one row.';
                statusMessage.className = 'mt-4 text-center font-semibold text-yellow-600';
                saveBtn.disabled = false;
                saveBtn.textContent = 'Save All Items to Menu';
                return;
            }

            // Add each valid item to the batch
            itemsToAdd.forEach(item => {
                const newDocRef = doc(collection(db, "menu"));
                batch.set(newDocRef, item);
            });

            try {
                await batch.commit();
                statusMessage.textContent = `Successfully added ${itemsToAdd.length} items to the menu!`;
                statusMessage.className = 'mt-4 text-center font-semibold text-green-600';
                generateRows(); // Clear the form by regenerating rows
            } catch (error) {
                console.error("Error adding items in bulk: ", error);
                statusMessage.textContent = 'An error occurred. Check the console.';
                statusMessage.className = 'mt-4 text-center font-semibold text-red-600';
            } finally {
                saveBtn.disabled = false;
                saveBtn.textContent = 'Save All Items to Menu';
            }
        });

        // Initial setup
        generateRows();

    </script>
</body>
</html>

